name: Run Script Daily

on:
  schedule:
    - cron: '30 0 * * *'  # 6:00 AM IST
  workflow_dispatch:

jobs:
  run_script:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.12'

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Run script
      run: python hindustan.py

    # - name: Add & Commit changes
    #   uses: EndBug/add-and-commit@v9.1.4
    #   with:
    #     add: '.'  # Specify the files to add (use '.' to add all changes)
    #     author_name: "GitHub Actions"
    #     author_email: "actions@users.noreply.github.com"
    #     commit: "--signoff"
    #     message: "Update PDF [skip ci]"
    #     push: "true"

    - name: Upload PDF as artifact
      uses: actions/upload-artifact@v3
      with:
        name: hindustan-pdf
        path: Hindustan-Dhanbad.pdf

    - name: Create release
      uses: actions/create-release@v1
      with:
        tag_name: $(date +'%Y-%m-%d')
        release_name: $(date +'%Y-%m-%d')
        draft: false
        prerelease: false

    - name: Upload PDF as release asset
      uses: actions/upload-release-asset@v1
      with:
        upload_url: ${{ steps.create_release.outputs.upload_url }}
        asset_path: Hindustan-Dhanbad.pdf
        asset_name: Hindustan-Dhanbad.pdf
        asset_content_type: application/pdf